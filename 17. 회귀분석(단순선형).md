# 📘 17일차 TIL: 회귀분석

## 1. 회귀분석의 정의와 존재 이유

* **핵심 정의:** 원인($x$)과 결과($y$) 사이의 관계를 **수학적 함수식** 으로 수치화하는 통계 기법.
* **왜 하는가?** 1.  **설명:** 어떤 요인이 결과에 얼마나 큰 영향을 주는지 파악 (인과관계).
2.  **예측:** 과거의 규칙을 바탕으로 새로운 데이터가 들어왔을 때 미래 결과 추정.
* **통계적 본질:** 단순히 선을 긋는 것이 아니라, $x$라는 조건에서의 **$y$값들의 평균(Conditional Expectation)** 을 추적하는 것.

---

## 2. 모델(Model)에 대한 명확한 정의

* **데이터 분석에서의 모델:** $y = f(x)$. 즉, 입력값($x$)을 정답($y$)으로 변환해주는 **연산 규칙**.
* **회귀 모델:** $y = wx + b$ 라는 선형 함수를 기본 모델로 사용함.
* $w$ (Weight, 가중치): 기울기. $x$가 1 단위 변할 때 $y$가 변하는 정도.
* $b$ (Bias, 편향): 절편. $w$가 0일 때의 기본값.



---

## 3. 회귀분석의 종류 상세 구분

회귀분석은 '데이터의 모양'이 아니라 **'수식의 구조'** 로 구분합니다.

| 종류 | 수식 형태 | 특징 및 핵심 차이 |
| --- | --- | --- |
| **단순 선형** | $y = w_1x + b$ | 독립변수 1개. 가장 직관적. |
| **다중 선형** | $y = w_1x_1 + w_2x_2 + b$ | 독립변수 여러 개. 실무에서 가장 많이 쓰임. |
| **다항 회귀** | $y = w_1x + w_2x^2 + b$ | **모양은 곡선이지만 선형 회귀**임. 가중치 $w$가 직선적으로 더해지기 때문. |
| **로지스틱** | $y = \text{Sigmoid}(wx+b)$ | 결과가 0~1 사이 확률로 나옴. **분류(Classification)** 에 사용. |
| **비선형 회귀** | $y = w_1 \cdot x^{w_2}$ | 가중치 $w$가 지수나 분모에 있음. 선형 대수학으로 풀 수 없음. |

---

## 4. 학습의 원리: 비용 함수(Cost Function)

모델이 '최적'이 되기 위해서는 **벌금(비용)** 을 최소화해야 합니다.

* **실제값 ($y$):** 우리가 수집한 진짜 정답 데이터.
* **예측값 ($\hat{y}$):** 현재 모델($wx+b$)이 계산해낸 임시 정답.
* **비용 함수 (MSE):** $\frac{1}{n} \sum (y_i - \hat{y})^2$
* 오차를 제곱하는 이유: 음수를 제거하고, 큰 오차에 더 큰 벌금을 부여하기 위함.


* **최적화 기법 (경사하강법):** 비용 함수의 기울기를 따라 낮은 곳으로 이동하며 최적의 $w, b$를 찾아가는 과정.

---

## 5. 모델 검증: "이 모델, 믿어도 될까?"

컴퓨터가 뽑아준 수치(회귀계수)가 진짜인지 검증하는 단계입니다.

1. **t-검정 (t-test):** 개별 독립변수($x$)의 영향력($w$)이 진짜 0이 아닌지 검증. (p-value < 0.05 이면 합격)
2. **결정계수 ($R^2$):** 이 모델이 전체 데이터의 변동성을 얼마나 잘 설명하는지 (0~1 사이, 1에 가까울수록 좋음).
3. **기본 가정 확인:** * **선형성:** $x$와 $y$가 직선 관계인가?
* **독립성:** 데이터끼리 서로 영향을 주지 않는가?
* **등분산성:** 오차의 크기가 일정한가?
* **정규성:** 오차가 정규분포를 따르는가?



---

## 6. 단순선형 회귀분석 RStudio 실습코드

```r
# 데이터 로드
data(ChickWeight)

# 구조 확인
str(ChickWeight)

# 상위 데이터 확인
head(ChickWeight)

# 상관계수 확인(해도, 안해도 됨)
x<-ChickWeight$Time
y<-ChickWeight$weight
cor(x,y)

# 회귀 모델 생성
model <- lm(weight ~ Time, data = ChickWeight)
# => y(= Weight)는 w * x(= Time) +b(= 절편편)

# 결과 요약 확인
summary(model)

# 회귀식 시각화
library(ggplot2)
ggplot(ChickWeight, aes(x = Time, y = weight)) +
  geom_point(alpha = 0.3) +                  # 실제 데이터 산점도
  geom_smooth(method = "lm", se = FALSE) +   # 회귀선 추가
  theme_minimal() +
  labs(title = "사료 종류별 병아리 성장 회귀 분석",
       x = "시간 (일)",
       y = "몸무게 (g)")

# 모델 시각적 진단
par(mfrow = c(2, 2)) # 그래프 4개를 한 화면에 보기
plot(model)

---------------------------------------------------------------
# summary 결과값:
Call:
lm(formula = weight ~ Time, data = ChickWeight)

Residuals:
     Min       1Q   Median       3Q      Max 
-138.331  -14.536    0.926   13.533  160.669 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)  27.4674     3.0365   9.046   <2e-16 ***
Time          8.8030     0.2397  36.725   <2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 38.91 on 576 degrees of freedom
Multiple R-squared:  0.7007,	Adjusted R-squared:  0.7002 
F-statistic:  1349 on 1 and 576 DF,  p-value: < 2.2e-16

# 해석:
# 회귀식의 기울기 w = 8.8030
# 회귀식의 절편 b = 27.4674

# ## 📊 회귀분석 결과 요약 보고서
# ### 1. 회귀 방정식 (Prediction Formula)

# * **해석:** 병아리가 태어났을 때의 기본 무게는 약 **27.47g**이며, 시간이 **1일 경과할 때마다 몸무게는 평균 8.8g씩 증가**합니다.

# ---

# ### 2. 모델의 신뢰도와 유의성 (Significance)

# * **변수의 유의성 (p-value):** `Time` 변수의 p-value가 `2e-16` 미만으로, 유의수준 0.05보다 훨씬 작습니다. 이는 **"시간과 몸무게는 우연이 아니라 확실한 인과관계가 있다"**는 것을 증명합니다. (별표 `***`가 이를 시각적으로 보여줍니다.)
# * **모델의 적합성 (F-statistic):** 모델 전체에 대한 p-value 역시 매우 낮으므로, 이 회귀 모델 자체가 통계적으로 매우 타당합니다.

# ---

# ### 3. 모델의 설명력과 정밀도 (Performance)

# * **결정계수 (R^2):** 본 모델은 병아리 몸무게 변화의 **약 70.1%를 설명**할 수 있습니다. 꽤 높은 수치이나, 나머지 29.9%는 사료 종류나 개체 차이 등 다른 변수의 영향이 있음을 시사합니다.
# * **예측 오차 (Residual Standard Error):** 평균적으로 모델의 예측값은 실제 몸무게와 약 **38.9g 정도의 오차**가 발생할 수 있습니다.

# ---

# ### 4. 잔차 진단 (Error Check)

# * **잔차 중앙값 (Median = 0.926):** 중앙값이 0에 가깝습니다. 이는 모델이 실제값보다 너무 높게 예측하거나 낮게 예측하는 **'편향(Bias)'이 거의 없이 공정하게 예측**하고 있음을 의미합니다.

# ---

# ## 💡 한 줄 결론

# > "이 모델은 **시간이 흐를수록 병아리의 몸무게가 유의미하게 증가함**을 입증하며( w=8.8, p<.001 ), 전체 데이터의 **70%를 설명하는 신뢰할 만한 모델**입니다. 다만, 30%의 미설명 부분과 38.9g의 평균 오차를 줄이기 위해 **'사료(Diet)' 변수를 추가한 다중 회귀 분석**을 고려해 볼 가치가 있습니다."

---------------------------------------------------------------
# 후속 검사(가정 검정)
① Residuals vs Fitted (선형성 & 등분산성 확인)
목표: 점들이 아무런 패턴 없이 골고루 흩어져 있어야 합니다.

나쁜 징후: 점들이 U자형이나 곡선을 그리면 "다항 회귀로 바꿔야 한다"는 뜻이고, 뒤로 갈수록 부채꼴로 퍼지면 "등분산성이 깨졌다"는 뜻입니다.

② Normal Q-Q (정규성 확인)
목표: 점들이 대각선 직선 위에 나란히 놓여 있어야 합니다.

나쁜 징후: 양 끝에서 점들이 직선을 이탈하면 "오차가 정규분포를 따르지 않는다"는 뜻입니다.

③ Scale-Location (등분산성 확인)
목표: 빨간색 실선이 수평을 유지해야 합니다.

나쁜 징후: 선이 위로 치솟거나 아래로 꺼지면 데이터 구간마다 오차의 크기가 다르다는 뜻입니다.

④ Residuals vs Leverage (이상치 확인)
목표: 모델에 너무 큰 영향을 미치는 **'나쁜 데이터(Outlier)'**가 있는지 찾습니다.

나쁜 징후: 빨간색 점선(Cook's distance) 밖으로 나간 점이 있다면, 그 데이터 한두 개가 모델 전체를 휘두르고 있다는 위험 신호입니다.

```
