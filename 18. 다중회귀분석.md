# 📘 18일차 TIL: 다중회귀분석

## 📝 TIL: 다중 회귀 분석 실습 및 모델 최적화 (R)

### 1. 데이터 탐색 및 상관관계 시각화

* **핵심** : 다중 회귀 모델을 만들기 전, 독립변수들 간의 상관관계를 파악하여 **다중공선성** 의 위험을 미리 인지합니다.
* **시각화 도구** : `corrplot`은 변수 간 관계를 한눈에 보여주고, `chart.Correlation`은 분포(히스토그램)와 상관계수를 동시에 제공합니다.

### 2. 다중 회귀 모델링 (Multiple Linear Regression)

* **공식** : $Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \dots + \epsilon$
* **해석** : `summary()` 결과에서 `Estimate`(회귀계수)는 다른 변수가 고정일 때 해당 변수가 1단위 증가할 때 의 변화량을 의미합니다.
* **명목형 변수의 수치화** : `iris$Species`와 같은 명목형 변수를 모델에 넣으면 R이 자동으로 **더미 변수(Dummy Variable)** 화(벡터라이징)하여 처리합니다.

### 3. 변수 선택법 (Stepwise Selection)

* **목적** : 불필요한 변수를 제거하여 **AIC/BIC** 가 낮은 간결한 최적 모델을 찾습니다.
* **전진 선택법(Forward)** : 상수항 모델에서 시작하여 기여도가 높은 변수를 하나씩 추가합니다.
* **후진 제거법(Backward)** : 모든 변수가 포함된 모델에서 기여도가 낮은 변수를 제거합니다.

---

## 💻 최적화된 실습 코드 (주석 포함)

```r
# 1. 데이터 확인 및 전처리
data(iris)
# str(iris) # 구조 확인: Species가 Factor(명목형)임을 확인

# 2. 상관관계 분석 (수치형 변수만 추출)
iris_num <- iris[, -5]
corr_matrix <- cor(iris_num)

library(corrplot)
corrplot(corr_matrix, 
         method = 'color',      # 색상으로 표현
         type = 'upper',        # 상삼각형만 표시
         addCoef.col = 'black', # 계수값 표시
         diag = FALSE)          # 자기 자신 제외

# 3. 다중 회귀 모델 생성
# m1: 특정 변수 선택 / m2: 모든 변수 포함(.)
m1 <- lm(Sepal.Length ~ Sepal.Width + Petal.Width + Petal.Length, data = iris)
m2 <- lm(Sepal.Length ~ ., data = iris) # Species까지 포함 (자동 벡터라이징)

summary(m2) # 모델 결과 해석 (R-squared, p-value 확인)

# 4. 변수 선택법 (Stepwise Selection)

# (1) 전진 선택법 (Forward Selection)
# 상수항 모델(가장 낮은 단계)에서 시작하여 변수를 추가
min_model <- lm(Sepal.Length ~ 1, data = iris)    # 아무것도 없는 모델
max_model <- lm(Sepal.Length ~ ., data = iris)    # 모든 변수가 있는 모델

step_forward <- step(min_model, 
                     scope = list(lower = min_model, upper = max_model), 
                     direction = "forward")

# (2) 후진 제거법 (Backward Elimination)
# 모든 변수가 있는 모델에서 시작하여 불필요한 변수 제거
step_backward <- step(max_model, direction = "backward")

# (3) 단계적 선택법 (Both)
# 넣고 빼기를 반복하며 최적의 AIC를 찾음
step_both <- step(min_model, 
                  scope = list(lower = min_model, upper = max_model), 
                  direction = "both")

# 5. 최종 모델 확인
summary(step_both)

# 6. 회귀 진단 (모델의 5대 가정 확인)
par(mfrow = c(2, 2))
plot(step_both)

```
