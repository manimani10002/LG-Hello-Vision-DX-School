
# 📘 28일차 TIL: 군집분석(Clustering) 마스터 노트

## 1. 군집분석의 본질

* **개념:** 별도의 정답(Label)이 없는 상태에서 데이터의 특성(Feature)만을 이용해 **유사한 개체끼리 그룹화**하는 비지도 학습.
* **핵심 원리:** 군집 내 응집도(Cohesion)는 최대화하고, 군집 간 분리도(Separation)는 최대화하는 것.
* **전제 조건:** 데이터 간의 **'거리'**를 측정하므로, 반드시 **데이터 표준화(`scale`)**가 선행되어야 함.

---

## 2. 계층적 군집화 (Hierarchical Clustering)

데이터를 밑바닥부터 하나씩 쌓아 올리거나(Bottom-up), 위에서 아래로 쪼개는(Top-down) 방식입니다.

### ① 거리 측정 방법 (Distance Metrics)

* **유클리드 거리 (Euclidean):** 가장 일반적인 직선 거리.
* **맨해튼 거리 (Manhattan):** 격자 형태의 경로 거리.

### ② 군집 결합 방법 (Linkage Methods)

R의 `hclust(..., method = "")` 옵션에 해당합니다.

* **Single (최단):** 두 군집에서 가장 가까운 점끼리의 거리. (사슬 현상 발생 위험)
* **Complete (최장):** 두 군집에서 가장 먼 점끼리의 거리. (**작성하신 코드에서 사용**)
* **Average (평균):** 모든 점 사이 거리의 평균. (군집의 크기가 비슷하게 유지됨)
* **Ward's D:** 군집 내 오차 제곱합을 최소화하는 방식. (가장 성능이 좋다고 평가받음)

### ③ 시각화: 덴드로그램 (Dendrogram)

* 데이터가 병합되는 과정을 보여주는 계통도.
* **해석:** 세로축의 높이(Height)가 높을수록 해당 군집 간의 이질성이 큼을 의미함.

---

## 3. 비계층적 군집화: K-평균 (K-means)

미리 정해진 개의 중심점(Centroid)을 기준으로 데이터를 할당하는 방식입니다.

### ① 작동 프로세스

1. **초기화:** 임의의 $k$개 중심점을 잡음.
2. **할당:** 각 데이터를 가장 가까운 중심점에 할당.
3. **갱신:** 군집화된 데이터들의 평균 지점으로 중심점을 이동.
4. **반복:** 중심점의 위치가 변하지 않을 때까지 2~3단계 반복.

### ② 최적의 K 찾기: 엘보우 방법 (Elbow Method)

* **WSS (Within-cluster Sum of Squares):** 군집 내 오차 제곱합.
* $k$가 커질수록 WSS는 줄어들지만, 너무 커지면 과적합이 발생함.
* **Elbow point:** WSS의 감소폭이 급격하게 둔화되는 지점이 최적의 $k$.

---

## 4. 군집화 평가 지표: 실루엣 계수 (Silhouette Coefficient)

작성하신 코드의 `wss`가 군집 내 응집도만 본다면, 실루엣은 **응집도와 분리도를 동시에** 평가합니다.

$$s(i) = \frac{b(i) - a(i)}{\max(a(i), b(i))}$$

* $a(i)$ : 내가 속한 군집 안에서의 평균 거리 (작을수록 좋음)
* $b(i)$ : 내가 속하지 않은 가장 가까운 군집과의 평균 거리 (클수록 좋음)
* **해석:**
* **1에 가까움:** 매우 잘 분리됨.
* **0 근처:** 군집 경계선에 위치함.
* **음수:** 잘못된 군집에 들어가 있음.



---

## 5. 실무 적용 시 주의사항 (Checklist)

1. **이상치(Outlier) 제거:** 거리 기반 알고리즘은 이상치에 매우 민감합니다.
2. **변수 선택:** 분석 목적과 상관없는 변수가 섞이면 군집의 품질이 떨어집니다.
3. **해석 가능성:** 군집 결과가 비즈니스적으로 혹은 도메인 지식으로 설명 가능한지 검토해야 합니다. (예: 아까 분석한 "도시화가 낮은데 살인율이 높은 그룹" 등)
